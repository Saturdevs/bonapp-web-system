<ng-template #deleteTemplate>
  <div class="modal-header">
    <h4 class="modal-title">Eliminar Producto del Pedido</h4>
  </div>
  <div class="modal-body">
    <div class="col-md-12">
      <div class="row">
        ¿Estas seguro que desea cancelar esta adición?
      </div>    
      <div class="row">
        <textarea (click)="selectText(obs)" #obs placeholder="Comentario..." 
        [(ngModel)]="deletedReason"></textarea>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="button special" (click)="deleteProductFromOrder()" 
      [disabled]="deletedReason === undefined || deletedReason === ''">Aceptar</button>
    <button type="button" class="button special" (click)="closeModalDeleteProd()">Cancel</button>
  </div>
</ng-template>

<ng-template #closeOrderTemplate>
  <app-order-close [order]="order" [cashRegisters]=cashRegisters [paymentTypes]=paymentTypes (close)="closeModal()"></app-order-close>
</ng-template>

<ng-template #optionsAndSizesTemplate>
  <div class="container col-md-12">
    <div class="row pageTitle primary-color">
      <div class="col-md-12">
        <h4 class="text-white text-center mb-0">{{ sizesAndOptionsModalTitle }}</h4>    
      </div>
    </div>
    <div class="modalContent">
      <div class="col-md-12">
        <div class="row" *ngIf="productToFindSizesAndOptions.sizes && productToFindSizesAndOptions.sizes.length > 0">
          <h6 class="selectSizeAndOptionsLabel">Tamaño:</h6>
          <div class="md-form form-group mr-2 col-md-6 col-lg-6 text-left">
              <mdb-select #queryType name="queryType" id="queryType" [options]="sizesSelect"
                  [(ngModel)]="sizeSelectedValue" placeholder="Choose your option" class="colorful-select dropdown-primary"></mdb-select>
          </div>
        </div>
        <div class="row" *ngIf="productToFindSizesAndOptions.options && productToFindSizesAndOptions.options.length > 0">
          <h6 class="selectSizeAndOptionsLabel">Opciones:</h6>
          <div class="md-form form-group mr-2 col-md-6 col-lg-6 text-left" *ngFor="let option of productToFindSizesAndOptions.options; let i = index">
            <mdb-checkbox (change)="onOptionSelectedChange(option)" value="option" name="productOption"> {{ option.name }}</mdb-checkbox>            
          </div>
        </div>
      </div>
    </div>
    <div class="row customFooterModal">
      <div class="footerButtons">
        <button type="button" class="btn btn-sm customButtonCancel waves-light" (click)="closeModalOptionsAndSizes()">Cancel</button>
        <button type="button" class="btn btn-primary btn-sm waves-light okButton" (click)="setProductOptionsAndSize(productToFindSizesAndOptions)" 
          [disabled]="productToFindSizesAndOptions.sizes && productToFindSizesAndOptions.sizes.length > 0 && sizeSelectedValue == 'default'">Aceptar</button>
      </div>
    </div>
  </div>
</ng-template>

<div class="row col-md-12 col-lg-12 col-sm-12 pr-0 pl-0 mr-0 ml-0" style="height: calc(100vh - 5.4rem);
overflow: auto; overflow-x: hidden;">
  <div class="d-flex flex-row flex-wrap col-md-8 col-lg-8 col-xs-8 col-sm-8 pr-0" style="height: 100%">
    <div class="row col-12 menusContainer pr-0 pl-0">
      <div class="d-flex align-items-center pr-0 pl-0 pb-0 pt-0 mr-0 ml-0 mt-0 mb-0" style="width: 100%">
        <button class="left-paddle paddle btn customPaddle waves-light" mdbRippleRadius style="left:0!important;">
          <
        </button>
        <div style="margin-left:8%;" *ngFor="let menu of menus" class="d-flex align-items-center menuButtonContainer">
          <a (click)="getCategories(menu._id); applyClassMenu(menu._id)" [ngClass]="{'activeItem': activeMenu == menu._id}" class="d-flex align-items-center justify-content-center btn btn-primary btn-md waves-light menuButton mt-0 mb-0" mdbRippleRadius><span>{{menu.name}}</span></a>
        </div>
        <button class="right-paddle paddle btn customPaddle waves-light" mdbRippleRadius>
          >
        </button>
      </div>          
    </div>
    <div class="row col-12 pr-0 pl-0 categoriesAndProductsContainer">
      <div class="col-3 categoriesContainer customScrollBar pr-0 pl-0 pb-0 pt-0 mr-0 ml-0 mt-0 mb-0">
        <div class="d-flex flex-wrap align-items-center justify-content-center categoryButtonContainer" *ngFor="let category of categories">
          <a (click)="getProductsAvailablesByCategory(category._id); applyClassCategory(category._id); categorySelected = true" [ngClass]="{'activeItem': activeCategory == category._id}"  class="d-flex align-items-center justify-content-center btn btn-primary btn-md waves-light categoryButton" mdbRippleRadius><span>{{category.name}}</span></a>
        </div>
      </div>
      <div *ngIf="products && products.length > 0" class="col-9 d-flex flex-wrap col-9 productsContainer customScrollBar pr-0 pl-0 pb-0 pt-0 mr-0 ml-0 mt-0 mb-0">
        <div class="productsButtonContainer" *ngFor="let product of products">
          <a (click)="validateSizesAndOptions(product, 1)" class="d-flex align-items-center justify-content-center btn btn-primary btn-md waves-light productButton" mdbRippleRadius><span>{{product.name}}</span></a>
        </div>
      </div>
      <!-- <div *ngIf="products && products.length = 0" class="col-9 d-flex flex-wrap col-9 productsContainer customScrollBar pr-0 pl-0 pb-0 pt-0 mr-0 ml-0 mt-0 mb-0">
        <span>No hay productos disponibles para la categoria seleccionada.</span>
      </div> -->
      <div *ngIf="products.length == 0 && categorySelected == false" class="col-9 d-flex justify-content-center col-9 productsContainer customScrollBar pr-0 pl-0 pb-0 pt-5 mr-0 ml-0 mt-0 mb-0">
          <h3>{{ noCategoriesText }}</h3>
      </div>
      <div *ngIf="products.length == 0 && categorySelected == true" class="col-9 d-flex justify-content-center col-9 productsContainer customScrollBar pr-0 pl-0 pb-0 pt-5 mr-0 ml-0 mt-0 mb-0">
        <h3>{{ noProductsAvailablesText }}</h3>        
    </div>
    </div>
  </div>
  <div class="col-md-4 col-lg-4 col-xs-4 col-sm-4 pl-0 pr-0">
    <div class="row secondary-color customTextColor customTableNumberTitle">
      <div class="row col-lg-12 col-md-12 col-sm-12">
        <h5>{{'Mesa ' + order.table | uppercase}}</h5>
      </div>
    </div>
    <div class="row">
      <div class="row col-lg-12 col-md-12 col-sm-12 customSubtittle">
          {{ order.created_at | date:'dd/MM/yy HH:mm' }}
      </div>
    </div>

    <div class="row">
      <div class="col-lg-12 col-md-12 col-sm-12 customAddProductsTitle"><span class="align-middle">{{ 'Adicionar' | uppercase }}</span></div>
      <div class="col-md-12 col-lg-12 col-sm-12 col-xs-12 customAddProductsSection">
        <div class="row">
          <div class="col-2">
            <input type="number" class="form-control" [(ngModel)]="qtyProd" id="prodQty" mdbActive>
          </div>
          <div class="md-form col-9">
            <input type="text" class="completer-input form-control mdb-autocomplete"
                   [(ngModel)]="searchStr"
                   (input)="getFilteredData()" (ngModelChange)="onChange()"
                   [mdbAutoCompleter]="auto"
                   placeholder="Buscar Producto">
            <mdb-auto-completer #auto="mdbAutoCompleter" textNoResults="No se encontraron resultados" (select)="addProductToPreOrderFromList()">
              <mdb-option *ngFor="let option of results" [value]="option.name">
                {{option.name}}
              </mdb-option>
            </mdb-auto-completer>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Listado de productos en pre order -->
    <div class="row customPreOrderAdition" *ngIf='preOrderProducts && preOrderProducts.length'>
      <div class="col-md-12 col-lg-12 col-sm-12 preordeerProduct" *ngFor="let product of preOrderProducts">
        <div class="row mb-2">
          <div class="col-3 p-0 productQuantityPriceContainer">
            <button (click)="updateProductQty(product, -1)" class="z-depth-0 btn buttonOrder btn-tb increaseDecreaceButton waves-effect waves-light float-left m-0">
              <span class="pb-0 mb-0"><i class="fa fa-minus increaseDecreaceIcon"></i></span>
            </button>
            
            <span class="pt-1 pr-2 pl-4">{{ product.quantity }}</span>

            <button (click)="updateProductQty(product, 1)" class="z-depth-0 buttonOrder btn btn-tb increaseDecreaceButton waves-effect waves-light float-right m-0">
              <span class="pb-0 mb-0"><i class="fa fa-plus increaseDecreaceIcon"></i></span>
            </button>
          </div>
          <div class="col-6 pl-0 pr-0">
            <span class="ml-2">
                {{ product.name }}            
            </span>  
            <span class="ml-4"><i class="fa fa-dollar fa-lg increaseDecreaceIcon"></i></span>
            <span class="pl-5 pr-2 productQuantityPriceContainer productPrice">
              {{ product.price }}
            </span>  
          </div>
          <div class="col-3 pl-0 pr-1 pl-4">
            <label (click)="showObservationBox(product)" class="z-depth-0 btn buttonOrder btn-tb increaseDecreaceButton waves-effect waves-light float-left m-0 mr-1">
              <span><i class="fa fa-comment increaseDecreaceIcon fa-lg"></i></span>
            </label>            
            <label (click)="removeProductFromPreOrder(product)" class="z-depth-0 btn buttonOrder btn-tb waves-effect increaseDecreaceButton waves-light float-left m-0 ml-1">
              <span><i class="fa fa-times increaseDecreaceIcon fa-lg"></i></span>
            </label>
          </div>
        </div>
        <div class="row mb-2 pr-2" *ngIf="product.observations !== undefined && product.observations !== ''">
            <textarea  class="md-textarea form-control" (click)="selectText(obs)" #obs [(ngModel)]="product.observations"></textarea>
        </div>
      </div>
      <div class="col-md-12 col-lg-12 col-sm-12 pt-2 pb-2 pl-1 totalToConfirm"><span>Total a confirmar: ${{ totalToConfirm }}</span></div>
      <div class="col-md-12 col-lg-12 col-sm-12 p-0 m-0 infoSection">
        <div class="float-left col-md-5 col-lg-5 col-sm-5 offset-md-7 pl-0">
          <button type="button" class="float-left btn btn-sm customButtonCancel waves-light ml-4 mr-0" mdbRippleRadius (click)="cancelPreOrder()" >Cancelar</button>
          <button type="button" class="float-right btn btn-sm btn-primary waves-light" mdbRippleRadius (click)="confirmPreOrder()" >Confirmar</button>
        </div>  
        <!-- <div class="float-right col-md-6 col-lg-6 col-sm-6 pr-2">
        </div>  -->
      </div>
    </div>
    <!-- Listado de productos en order -->
    <div class="row mt-0 productsInOrder" *ngIf='order.users[0].products && order.users[0].products.length'>
      <div class="col-lg-12 col-md-12 col-sm-12 productLine" *ngFor="let product of order.users[0].products">
        <div class="row mb-0">
          <div class="col-2 p-0 pl-3">
            <span>{{ product.quantity }}</span>
          </div>
          <div class="col-6 p-0">
            <span>{{ product.name }}</span>
          </div>
          <div class="pl-4 pr-1 pb-2">
            <span>$ {{ product.price }} </span>
          </div>
          <div class="col-2 p-0">
            <button type="button" [disabled]="product.deleted === true" class="z-depth-0 btn buttonOrder btn-tb btn-primary waves-effect waves-light float-left mt-0" (click)="showModalRemoveProduct(deleteTemplate, product)">
            <i class="fa fa-times fa-1x"></i>
            </button>
          </div>
        </div>  
        <div class="row mb-2">
          <div *ngIf="product.observations !== undefined && product.observations !== ''">
            <span>{{ product.observations }}</span>
          </div>
          <div class="pl-4" *ngIf="product.deleted === true">
            <span>- CANCELADO: {{ product.deletedReason }}</span>
          </div>
        </div>      
      </div>
    </div>

    <!-- <div class="row pl-2 customDivHeight" *ngIf='order.users[0].products && order.users[0].products.length'>
      <ul class="list-group">
        <div class="btn-group customProductMargin" *ngFor="let product of order.users[0].products" data-toggle="buttons">   
          <div class="col-md-12">  
            <div class="row">
              <p>{{ product.quantity }}</p>

              <li class="list-group-item customProductShowingName pb-1 pt-0">
                  {{ product.name }}              
              </li>  

              <p class="mr-1">$ {{ product.price }} </p>  
              
              <button 
                type="button" 
                [disabled]="product.deleted === true"
                class="z-depth-0 btn customSizeY btn-tb btn-primary waves-effect waves-light float-left" 
                (click)="showModalRemoveProduct(deleteTemplate, product)">
                <i class="fa fa-times fa-1x"></i>
              </button>
            </div>     
            <div class="row">
              <div *ngIf="product.observations !== undefined && product.observations !== ''">
                {{ product.observations }}
              </div>

              <div class="pl-4" *ngIf="product.deleted === true">
                <p> - CANCELADO: {{ product.deletedReason }} </p>
              </div>
            </div>
          </div>
        </div>
      </ul>
    </div>     -->

    <!--Total-->
    <div class="row">
      <div class="col-lg-6 col-md-6 col-sm-6 totalOrder">
        <span class="float-left">{{'Total' | uppercase}} </span>
      </div>
      <div class="col-lg-6 col-md-6 col-sm-6 totalOrder pr-4">
        <span class="float-right">{{ '$ ' + order.totalPrice | uppercase }}</span>
      </div>      
    </div>
    <div class="row">
      <div class="col-4 offset-4 mt-2">               
        <button type="button" class="btn btn-md btn-primary waves-light" mdbRippleRadius (click)="closeTable(closeOrderTemplate)">Cerrar Mesa</button>
      </div>
    </div>
  </div>
</div>